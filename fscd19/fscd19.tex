
\documentclass[a4paper,USenglish,cleveref, autoref]{lipics-v2019}
%This is a template for producing LIPIcs articles.
%See lipics-manual.pdf for further information.
%for A4 paper format use option "a4paper", for US-letter use option "letterpaper"
%for british hyphenation rules use option "UKenglish", for american hyphenation rules use option "USenglish"
%for section-numbered lemmas etc., use "numberwithinsect"
%for enabling cleveref support, use "cleveref"
%for enabling cleveref support, use "autoref"

% \usepackage{dsfont} % black-board bold numbers, package doublestroke
% LACKS: \mathds{0}

% Disallowed packages:
% - enumitem
% - paralist
% - natbib
% - wrapfig

% Disallowed:
% - conditional inclusion of content
% - splitting over several files

% LIPICS enumerations
% - itemize
% - enumerate 1.
% - alphaenumerate (a)
% - romanenumerate (i)
% - bracketenumerate (1)

% LIPICS environments
% - lstlisting
% - theorem
% - lemma
% - corollary
% - proposition
% - exercise
% - definition
% - example
% - note and note*
% - remark and remark*
% - claim and claim*
% - proof and claimproof

% Features
% - env: claim and claimproof inside proof

% References to lemmata
% - \cref and \autoref (includes name, like Corollary 3)


%\graphicspath{{./graphics/}}%helpful if your graphic files are in another directory

\input{macros}

\bibliographystyle{plainurl}% the mandatory bibstyle

\title{Normalization by Evaluation for Call-by-Push-Value and Focused Lambda-Calculus}

\titlerunning{NbE for CBPV and Focusing}%optional, please use if title is longer than one line

\author{Andreas Abel}
  {Department of Computer Science and Engineering,
    Chalmers and Gothenburg University,
    Sweden \and
    \url{www.cse.chalmers.se/~abela}
  }
  {andreas.abel@gu.se}
  {https://orcid.org/0000-0003-0420-4492}
  {VR Grant 2014-04864 \emph{Termination
      Certificates for Dependently-Typed Programs and Proofs via
      Refinement Types}
  }
% TODO mandatory, please use full name;
% only 1 author per \author macro;
% first two parameters are mandatory, other parameters can be empty.
% Please provide at least the name of the affiliation and the country.
% The full address is optional

\author{Frederik Folkmar Ramcke}
  {Department of Computer Science and Engineering,
    Chalmers and Gothenburg University,
    Sweden
  }
  {}%email
  {}%orcid
  {}%funding

\authorrunning{A. Abel and F. F. Ramcke}%TODO mandatory. First: Use abbreviated first/middle names. Second (only in severe cases): Use first author plus 'et al.'

\Copyright{Andreas Abel and Frederik F. Ramcke}%TODO mandatory, please use full first names. LIPIcs license is "CC-BY";  http://creativecommons.org/licenses/by/3.0/

\ccsdesc[100]{General and reference~General literature}
\ccsdesc[100]{General and reference}%TODO mandatory: Please choose ACM 2012 classifications from https://dl.acm.org/ccs/ccs_flat.cfm

\keywords{Evaluation, Intuitionistc Propositional Logic,
  Lambda-Calculus, Monad, Normalization,
  Polarized Logic, Semantics}%TODO mandatory; please add comma-separated list of keywords

\category{}%optional, e.g. invited paper

\relatedversion{}%optional, e.g. full version hosted on arXiv, HAL, or other respository/website
%\relatedversion{A full version of the paper is available at \url{...}.}

\supplement{}%optional, e.g. related research data, source code, ... hosted on a repository like zenodo, figshare, GitHub, ...

%\funding{(Optional) general funding statement \dots}%optional, to capture a funding statement, which applies to all authors. Please enter author specific funding statements as fifth argument of the \author macro.

\acknowledgements{ The presentation of this NbE proof and its
Agda formalization benefited greatly from discussions with Christian
Sattler.}%optional

%\nolinenumbers %uncomment to disable line numbering

%\hideLIPIcs  %uncomment to remove references to LIPIcs series (logo, DOI, ...), e.g. when preparing a pre-final version to be uploaded to arXiv or another public repository

%Editor-only macros:: begin (do not touch as author)%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\EventEditors{Jakob Rehof and XXX}
\EventNoEds{2}
\EventLongTitle{Formal Structures for Computation and Deduction}
\EventShortTitle{FSCD 2019}
\EventAcronym{FSCD}
\EventYear{2019}
\EventDate{June 24--30, 2019}
\EventLocation{Dortmund, Germany}
\EventLogo{}
\SeriesVolume{}
\ArticleNo{}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\maketitle

\begin{abstract}
  We extend normalization by evaluation (NbE) to call-by-push-value
  (CBPV) and focused intutitionistic propositional logic.
  The developments have been partially formalized in Agda.
\end{abstract}


\section{Introduction}
\label{sec:intro}


\nocite{bergerSchwichtenberg:lics91}

\nocite{jungTiuryn:tlca93}

\nocite{altenkirchHofmannStreicher:ctcs95}

\nocite{abel:habil}

\nocite{danvy:popl96}

\nocite{fioreSimpson:tlca99}

\nocite{altenkirchDybjerHofmannScott:lics01}

\nocite{balatDiCosmoFiore:popl04}

\nocite{altenkirchUustalu:flops04}

\nocite{barral:PhD}

\nocite{scherer:popl17}


\section{Normalization by Evaluation for the Simply-Typed Lambda
  Calculus with Sums}
\label{sec:lambda}

In this section, we review the normalization by evaluation (NbE)
argument for the simply-typed lambda calculus (STLC) with weak sums, setting
the stage for the later sections.
%
We work in a constructive type-theoretic meta-language, with the basic judgement
$t : T$ meaning that object $t$ is an inhabitant of type $T$.
Meta-theoretic types can be thought of as sets, thus, the colon $:$
replaces the standard notion of elementhood $\in$, and we are free to
reuse $\in$ for other purposes.

\subsection{Contexts and indices}

We adapt a categorical aka de Bruijn style for the abstract syntax of
terms, which we conceive as intrinsically well-typed.  In de Bruijn
style, a context $\Gamma$ is just a snoc list of simple types $A$,
meaning we write context extension as $\cext \Gamma A$, and the empty
context as $\cempty$.  Membership \fbox{$A \in \Gamma$} and sublist
relations \fbox{$\Gamma \sublist \Delta$} are given inductively by the
following rules:
\begin{gather*}
  \nru{\tzero}{}{A \in \cext \Gamma A}
\qquad
  \nru{\tsuc}{A \in \Gamma}{A \in \cext \Gamma B}
\qquad
  \nru{\tdone}{}{\cempty \sublist \cempty}
\qquad
  \nru{\tlift}
    {\Gamma \sublist \Delta}
    {\cext \Gamma A \sublist \cext \Delta A}
\qquad
  \nru{\tweak}
    {\Gamma \sublist \Delta}
    {\Gamma \sublist \cext \Delta A}
\end{gather*}
We consider the rules as introductions of the indexed types
$\_{\in}\_$ and $\_{\sublist}\_$ and the rule names as constructors.
For instance, $\suc \tzero : A \in \cext {\cext \Gamma A} B$ for any
$\Gamma$, $A$, and $B$; and if we read $\tsuc^n\,\tzero$ as unary
number $n$, then $x : A \in \Gamma$ is exactly the (de Bruijn) index
of $A$ in $\Gamma$.

We can define
\fbox{$\tid : \Gamma \sublist \Gamma$} and \fbox{$\_{\rcomp}\_ : \Gamma
\sublist \Delta \to \Delta \sublist \Phi \to \Gamma \sublist \Phi$}
by recursion, meaning that the (proof-relevant)
sublist relation is reflexive and transitive.
% The sublist relation is reflexive and transitive, the witnesses
% \fbox{$\tid : \Gamma \sublist \Gamma$} and \fbox{$\_{\rcomp}\_ : \Gamma
% \sublist \Delta \to \Delta \sublist \Phi \to \Gamma \sublist \Phi$}
% have easy recursive definitions.
Thus, lists $\Gamma$ form a category
$\Cxt$ with morphisms $\tau : \Gamma \sublist \Delta$, and the category laws
hold propositionally, e.g., we have $\id \rcomp \tau \equiv \tau$ in
propositional equality for all morphisms $\tau$.

The category $\Cxt$ allows us to consider $A{\in}\_$ as a presheaf over
$\Cxt\op$ for any $A$, witnessed by \fbox{$\treindex : \Gamma \sublist
  \Delta \to A \in \Gamma \to A \in \Delta$}, which is the morphism
part of functor from $\Cxt$ to $\Set$, mapping object $\Gamma$ to the
set $A \in \Gamma$ of the indices of $A$ in $\Gamma$.
The associated naturality laws \fbox{$\treindex\,\tid\,x \equiv x$}
and \fbox{$\treindex\,\tau_2\,(\treindex\,(\tau_1\,x)) \equiv
\treindex\,(\tau_1 \rcomp \tau_2)\,x$} hold propositionally.

\subsection{STLC and its normal forms}

Simple types shall be given by the grammar
\fbox{$S,T ::= P \mid S \To T \mid S \times T \mid \tyone \mid S + T
  \mid \tyzero$}.
Intrinsically well-typed lambda-terms, in abstract syntax,
are just inhabitants $t$ of the type \fbox{$A \from \Gamma$},
inductively defined by the following rules.
\begin{gather*}
  \nru{\tvar}{A \in \Gamma}{A \from \Gamma}
\qquad
  \nru{\tabs}{B \from \cext \Gamma A}{A \To B \from \Gamma}
\qquad
  \nru{\tapp}
    {A \To B \from \Gamma \qquad A \from \Gamma}
    {B \from \Gamma}
\\[2ex]
  \nru{\tunit}{}{\tyone \from \Gamma}
\qquad
  \nru{\tpair}
    {A_1 \from \Gamma \qquad A_2 \from \Gamma}
    {A_1 \times A_2 \from \Gamma}
\qquad
  \nru{\tprj_i}
    {A_1 \times A_2 \from \Gamma}
    {A_i \from \Gamma}
\\[2ex]
  \nru{\tinj_i}
    {A_i \from \Gamma}
    {A_1 + A_2 \from \Gamma}
\qquad
  \nru{\tcase}
    {A_1 + A_2 \from \Gamma
      \qquad C \from \cext \Gamma A_1
      \qquad C \from \cext \Gamma A_2
    }{C \from \Gamma}
\qquad
  \nru{\tabort}
    {\tyzero \from \Gamma}
    {C \from \Gamma}
\end{gather*}
The skilled eye of the reader will immediately recognize the proof
rules of intuitionistic propositional logic (IPL) under the
Curry-Howard isomorphism.  A term such as
\(
  \tabs\,(\tabs\,(\tpair\,
    (\tvar\,(\tsuc\,\tzero))\,
    (\tabs\,(\tapp\,(\tvar\,(\tsuc\,\tzero))\,(\tvar\,\tzero)))))
\)
could in concrete syntax be rendered as
\(
  \lambda x.\,\lambda y.\,(x,\,\lambda z.\,y\,z)
  .
\)
We leave the exact connection to a printable
syntax of the STLC to imagination of the reader,
as we shall not be concerned with considering
concrete terms in this article.

Terms of type $A$ form a presheaf
$A{\from}\_$ as witnessed by the standard weakening operation%
\footnote{Here, $\tren$ is short for \emph{renaming}, but in a nameless
calculus we should better speak of \emph{reindexing}, which could, a
bit clumsily, also abbreviated to $\tren$.}
\fbox{$\tren : \Gamma \sublist \Delta \to A \from \Gamma \to A \from \Delta$}
defined by recursion over $t : A \from \Gamma$,
and naturality laws for $\tren$ analogously to $\treindex$.

Normal forms%
\footnote{%
There is also a stronger
notion of normal form, requiring that two \emph{extensionally equal}
lambda-terms, \ie, those that denote the
same set-theoretical function, have the same normal form
\cite{mitchell:foundations,altenkirchDybjerHofmannScott:lics01,scherer:popl17}.
Such normal forms do not have a simple inductive definition, and we
shall not consider them in this article.
}
are logically characterized as those fulfilling the
\emph{subformula} property \cite{prawitz:natded,matthes:shortproofs}.
Normal forms \fbox{$t : \Nf A \Gamma$} are mutually defined with
\emph{neutral} normal forms \fbox{$t : \Ne A \Gamma$}.
In the following inductive definition, we reuse the rule names from the
term constructors.
\begin{gather*}
  \nru{\tvar}{A \in \Gamma}{\Ne A \Gamma}
\qquad
  \nru{\tabs}{\NfC B {\cext \Gamma A}}{\NfP {A \To B} \Gamma}
\qquad
  \nru{\tapp}
    {\NeP {A \To B} \Gamma \qquad \Nf A \Gamma}
    {\Ne B \Gamma}
\qquad
  \nru{\tne}{\Ne A \Gamma}{\Nf A \Gamma}
\\[2ex]
  \nru{\tunit}{}{\Nf \tyone \Gamma}
\qquad
  \nru{\tpair}
    {\Nf {A_1} \Gamma \qquad \Nf {A_2} \Gamma}
    {\NfP {A_1 \times A_2} \Gamma}
\qquad
  \nru{\tprj_i}
    {\NeP {A_1 \times A_2} \Gamma}
    {\Ne {A_i} \Gamma}
\\[2ex]
  \nru{\tinj_i}
    {\Nf {A_i} \Gamma}
    {\NfP {A_1 + A_2} \Gamma}
\quad
  \nru{\tcase}
    {\NeP {A_1 + A_2} \Gamma
      \quad \NfC C {\cext \Gamma A_1}
      \quad \NfC C {\cext \Gamma A_2}
    }{\Nf C \Gamma}
\quad
  \nru{\tabort}
    {\Ne \tyzero \Gamma}
    {\Nf C \Gamma}
\end{gather*}
The new rule $\tne$ embeds $\tNe$ into $\tNf$,
\ie, allows us to forget neutrality.  Needless to say, $\tNe\,A$ and
$\tNf\,A$ are presheaves, \ie, support reindexing with $\tren$ just as terms do.
From a normal form we can extract the term via a overloaded function
\fbox{$\tm\_ : \Nf A \Gamma \to A \from \Gamma$} and
\fbox{$\tm\_ : \Ne A \Gamma \to A \from \Gamma$}
that discards constructor $\tne$ but keeps all other constructors.
This erasure function naturally commutes with reindexing, making it a
natural transformation between the presheaves $\tNf\,A$ ($\tNe\,A$,
resp.) and $A{\from}\_$.  We shall simply write, for instance,
\fbox{$\tNf\,A \todot A{\from}\_$} for such presheaf morphisms.

\emph{Proof normalization} is concerned with finding a normal form
$u : \Nf A \Gamma$ for each derivation $t : A \from \Gamma$.  However,
\emph{term normalization} additionally requires that $\tm u \cong t$
with respect to a equational theory $\cong$ on terms.

\subsection{Proof normalization}

For didactical purposes, let us first focus on the simpler task of
constructing a normalization function
\fbox{$\tnorm : A \from \Gamma \to \Nf A \Gamma$}
that does not guarantee any relation between its input term $t$ and
output normal form $u$.
% \emph{Normalization by evaluation} (NbE) decomposes normalization as
% \fbox{\(
%   \norm[\Gamma] A (t : A \from \Gamma)
%   = \down[\Gamma] A \dent t {\idenv\Gamma}
% \)}
% which is
% \emph{evaluation}
% \nofbox{$\dent \_ \_ : (t : A \from \Gamma) \to \Den \Gamma \Delta \to
%   \Den A \Delta$}
% in the identity environment \nofbox{$\idenv\Gamma : \Den \Gamma \Gamma$}
% followed by
% \emph{reification}
% \nofbox{$\downG A : \Den A \Gamma \to \Nf A \Gamma$}.
\emph{Normalization by evaluation} (NbE) decomposes normalization as
\fbox{\(
%  \norm[\Gamma] A (t : A \from \Gamma)
  \tnorm\, (t : A \from \Gamma)
  = \down A \dent t {\idenv\Gamma}
\)}
which is
\emph{evaluation}
\nofbox{$\dent \_ \_ : (t : A \from \Gamma) \to \den \Gamma \todot
  \den A$}
in the identity environment \nofbox{$\idenv\Gamma : \den \Gamma \Gamma$}
followed by
\emph{reification}
\nofbox{$\down A : \den A \todot \tNf A$}.


\clearpage

\subsection{Term normalization}

Defining%
\footnote{%
A more accurate presentation of $\tNF$ would be
$\sum_{u : \tNf A\,\Gamma} (\tm u \cong t)$
in order to make absolutely clear that we
want get hold of the witness $u$ of the existential statement;
however, we shall only use constructive
existentials
in this article and thus stick to the notation $\exists$.
We mean \emph{constructive existence} in
  contrast to classical existence and
  \emph{mere existence} from Homotopy Type Theory which
  requires propositional truncation.
}
\fbox{$\NF t = \exists u \of \tNf A\,\Gamma.\; \tm u \cong t$}
% for $t : A \from \Gamma$,
we aim to construct a normalization function
\[
  \tnorm : (t : A \from \Gamma) \to \NF t
\]
that gives us for each term $t$ a $\cong$-equal normal form $u$.

\section{Call-By-Push Value}
\label{sec:cbpv}

\section{Focused Intuitionistic Propositional Logic}
\label{sec:fipl}

\section{Conclusion}
\label{sec:concl}

\bibliography{auto-fscd19}

% \appendix

\end{document}
